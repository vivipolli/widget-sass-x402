# EmbedPay3 - Cronos x402 Recurring Subscription Widget (SaaS Payments)

<img src="./frontend/public/logo.png" alt="EmbedPay3 Logo" width="120" />

**A production-style, non-custodial recurring payment workflow for SaaS subscriptions on Cronos EVM — powered by x402.**

This project was built for the **Cronos x402 Paytech Hackathon**, focusing on **x402-style programmatic payments** and **agentic/workflow automation** on-chain.

## Why this matters 

Recurring payments are where most Web3 “payment demos” break:
- Users don’t want (and won’t accept) a MetaMask prompt every month.
- Merchants don’t want to custody keys or manage gas.
- Teams need something embeddable, reliable, and composable into real products.

**Our solution:** a **2-line iframe widget** that lets customers **sign once** (EIP-3009), then enables **recurring monthly settlement** via the **x402 Facilitator** with **gas sponsorship** — keeping funds **in the user’s wallet** until the moment of payment.

## What’s implemented today

- **Merchant dashboard**: configure `merchantId`, recipient wallet, monthly price and generate the iframe embed code.
- **Embeddable payment widget (iframe)**:
  - Connects MetaMask on Cronos Testnet
  - Generates a valid **x402 payment header** using **EIP-3009**
  - Creates a subscription in the backend with a **reusable authorization**
- **Backend automation**:
  - `SubscriptionService` stores subscriptions (in-memory for demo)
  - `RecurringScheduler` checks due subscriptions and creates payment “intents”
  - `SimpleExecutor` verifies & settles payments via **x402 Facilitator**
- **On-chain transparency**:
  - `IntentRegistry.sol` registers intents on-chain and marks them executed (demo-friendly audit trail)

## Architecture (end-to-end flow)

```
Merchant Dashboard (HTML)  ── generate embed code ──►  SaaS Platform (Demo HTML)
                                                           │
                                                           ▼
                                                    Payment Widget (iframe)
                                                     - Connect wallet
                                                     - EIP-3009 sign once
                                                     - x402 payment header
                                                           │
                                                           ▼
Backend API (Node/Express)
  - SubscriptionService (store subscription)
  - RecurringScheduler (monthly due check)
  - IntentService + IntentRegistry (on-chain record)
  - SimpleExecutor + ExecutionService
                                                           │
                                                           ▼
x402 Facilitator (Crypto.com)  ── gas-sponsored settlement ──►  Cronos EVM Testnet
```

## Demo URLs

- **Landing**: `http://localhost:5173`
- **Merchant dashboard**: `http://localhost:5173/merchant-dashboard.html`
- **SaaS platform demo**: `http://localhost:5173/saas-platform-demo.html`
- **Widget (standalone)**: `http://localhost:5173/widget`

## Security model (what makes it non-custodial)

- The **customer signs** the authorization in MetaMask.
- The backend stores the **x402 payment header** and uses it to settle later.
- Settlement **debits from the customer wallet** when the payment is executed.
- Gas fees are **sponsored by the x402 Facilitator**.

## Local setup

### Prerequisites
- Node.js 18+
- Package manager: `yarn` or `npm`
- MetaMask on **Cronos Testnet** (chainId `338`)
- Test tokens: **DevUSDCe** (contract: `0xf329184c1b464411bd683a2e8f42c1bfe42b2331`)

### 1) Backend

```bash
cd backend
yarn install || npm install
cp .env.example .env
```

Set these variables in `backend/.env`:
- `RPC_URL` (default: `https://evm-t3.cronos.org`)
- `NETWORK=cronos-testnet`
- `PRIVATE_KEY` (backend executor wallet key; used only to submit on-chain registry updates and as fallback when no user header is provided)
- `CONTRACT_ADDRESS` (**required**; deployed `IntentRegistry` address)
- `PORT=8787`

Start backend:

```bash
yarn dev || npm run dev
```

### 2) Frontend

```bash
cd frontend
yarn install || npm install
yarn dev || npm run dev
```

## Integration (what a SaaS needs to add)

Generated by the merchant dashboard:

```html
<iframe
  src="http://localhost:5173/widget?merchantId=demo-merchant-123&amount=9990000&recipient=0xYourWallet&token=0xf329184c1b464411bd683a2e8f42c1bfe42b2331"
  width="100%"
  height="600"
  frameborder="0"
  style="max-width: 420px; margin: 0 auto; display: block;"
></iframe>
```

## Why this is compelling

- **Innovation**: “Sign once → recurring settlement” UX that feels like Web2 subscriptions, enabled by **x402 + EIP-3009**.
- **Automated workflows**: a programmatic pipeline (scheduler + executor) that triggers on-chain settlement **without monthly user prompts**.
- **Execution quality**: a complete, demo-ready flow (merchant → embed → customer sign → backend automation → on-chain settlement trail).
- **Ecosystem value**: a reusable integration pattern (a **payment widget for SaaS**) that makes x402 easy to adopt in real products.

## Marketing & monetization strategy

### Positioning (the product)

- **Product**: an embeddable subscription payment widget that turns stablecoin recurring billing into a drop-in SaaS capability.
- **Primary promise**: “Add stablecoin subscriptions with a production-style checkout in minutes (iframe).”
- **Differentiator**: the widget UX and integration simplicity (ship without building custom Web3 payment UI).

### Target market (who buys, who pays)

- **Buyer / payer**: SaaS merchants (founders, PMs, dev leads) who want stablecoin recurring billing.
- **End user**: customers paying in stablecoins for a monthly plan.
- **Ideal early adopters**:
  - SaaS with international users and card friction (declines, FX, chargebacks).
  - Digital subscriptions (AI tools, devtools, communities, content, APIs).

### Pricing model (merchant SaaS)

- **Free**:
  - 1 merchant, 1 plan, limited active subscriptions.
  - “Powered by” branding.
- **Pro (monthly)**:
  - Multiple plans, branding removal, webhook events, basic analytics, priority support.
- **Business / Enterprise**:
  - SLA, custom limits, multi-merchant support, advanced reporting, compliance-friendly export.

### What makes it compelling for stablecoin subscription payers

- **Familiar UX**: checkout inside the widget; no complex on-chain flows exposed.
- **One-time signature**: no monthly wallet prompts.
- **Transparency**: on-chain settlement visibility for every payment.

## Notes / limitations (demo scope)

- Storage is **in-memory** (easy for demo; can be replaced by DB).
- Token support is demo-focused: **DevUSDCe** on Cronos Testnet.
- Schedule is **monthly** (MVP choice for the hackathon scope).

## Future extensions (after hackathon)

- Merchant registry + API keys
- Customer portal (manage/cancel subscriptions)
- Multi-token support + pricing abstraction
- Webhooks & receipts for SaaS backends
- Mainnet deployment + production persistence
